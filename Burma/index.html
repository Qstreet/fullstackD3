<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.12.0/d3.min.js"></script>
    <style>
      body {outline: 1px dotted blue;}
      svg {
        padding: 5px;
        margin:  5px;}
      .tsText { font-size: 0.2rem;

      }
    </style>
    <title>35 Townships</title>
  </head>
  <body>
    <div id="container"></div>

    <script>
      (function() {
        "use strict";
        const geoJson = "data/burma.json";
        const watch35csv = "data/townships.csv";
        const parseDate = d3.timeParse("%Y-%m-%d");
        var t = d3.transition().duration(750);

        // DIMENSIONS
        const width = 300;
        const height = 700;
        const adj = 0;

        var projection = d3.geoMercator()
            .translate([width/2,height/2])
            .scale([1000])
            .center([97,22])
            
        var path = d3.geoPath(projection);

        const svg = d3
          .select("div#container")
          .append("svg")
          .attr("preserveAspectRatio", "xMidYMid meet")
          .attr(
            "viewBox",
            "-" +
              adj +
              " -" +
              adj +
              " " +
              (width + adj * 1) +
              " " +
              (height + adj * 3)
          )
          // .classed("svg-content", true);

// //Define what to do when dragging
// var dragging = function(d) {

// //Log out d3.event, so you can see all the goodies inside
// //console.log(d3.event);

// //Get the current (pre-dragging) translation offset
// var offset = projection.translate();

// //Augment the offset, following the mouse movement
// offset[0] += d3.event.dx;
// offset[1] += d3.event.dy;

// //Update projection with new offset
// projection.translate(offset);

// //Update all paths and circles
// svg.selectAll("path")
//   .attr("d", path);

// svg.selectAll("circle")
//   .attr("cx", function(d) {
//     return projection([d.lon, d.lat])[0];
//   })
//   .attr("cy", function(d) {
//     return projection([d.lon, d.lat])[1];
//   });

// }

// //Then define the drag behavior
// var drag = d3.drag()
//      .on("drag", dragging);

// //Create a container in which all pan-able elements will live
// var map = svg.append("g")
//     .attr("id", "map")
//     .call(drag);  //Bind the dragging behavior

        // GET DATA
      d3.csv(watch35csv).then(function(csvData){
          
        d3.json(geoJson)
          .then(function(mapData) {

            for (var i = 0; i < csvData.length; i++) {

              var isWatch35 = csvData[i].Watch35;
              var townshipName = csvData[i].Township_Name_Eng;

              for (var j = 0; j < mapData.features.length; j++) {
                var mapDataTsName = mapData.features[j].properties.TS;
                if (townshipName === mapDataTsName) {
                  mapData.features[j].properties.watch35 = isWatch35;
                }
              }
            }
          draw(mapData);
        })
          .catch(function(err) {
            console.log(err);
          });
      })

          function draw(mapData){
            svg.selectAll('path')
              .data(mapData.features)
              .enter()
              .append('path')
              .attr('d',path)
              .attr('fill', function(d){
                if (d.properties.watch35 === '1'){
                  return '#224a6b';
                } else {
                  return '#aaa';
                }
              });
            

          var map = svg.append('g');
          map.selectAll('text')
            .data(mapData.features)
            .enter()
            .append('text')
            .attr('class','tsText')
            .attr('x', function(d){
              return path.centroid(d)[0];
            })
            .attr('y', function(d){
              return path.centroid(d)[1];
            })
            .text(function(d){
              if (d.properties.watch35 === '1') {
              return d.properties.TS;
              }
            })

          }


      })(); // close IIFE
    </script>
  </body>
</html>
